= To Write Mapped Content to a File
:keywords: file, ftp, connector, operation
:toc:
:toc-title:

toc::[]

// For Anypoint Studio, Design Center: FTP connector

This example reads a JSON file from an FTP server, then writes a subset of that JSON content to a new file on the FTP server. The example uses DataWeave to map fields from the source file to fields in the destination file.

. Provide a Polling trigger for your flow.
+
You do not need to change any settings.
+
. Set up a Read operation for the FTP connector:
.. Set up or select a configuration for the FTP connector.
+
You can set up an <<see_also,FTP or SFTP configuration>>.
+
.. Provide the File Path to a JSON file.
+
Example: `full_record.json`
+
Assume that the JSON content has several records that look something like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "address": {
      "street": "Victor Plains",
      "suite": "Suite 879",
      "city": "Wisokyburgh",
      "zipcode": "90566-7771",
      "geo": {
        "lat": "-43.9509",
        "lng": "-34.4618"
      }
    },
    "phone": "010-692-6593 x09125",
    "website": "anastasia.net"
  }
]
----
+
. After the Read operation, configure a Write operation for the FTP connector:
.. Continue to use the same FTP configuration that you used for the Read operation.
.. In the Write operation, provide a Path to a new JSON file.
+
Example: `partial_record.json`
+
.. Delete the value `payload` from the Content field.
. Use the next set of steps on the Write operation to provide a mapping between JSON input and output examples.
.. From the Input tab in the Write operation, add and save a custom JSON data type example that looks like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  }
]
----
+
.. From the Output tab in the Write operation, add and save a custom JSON data type example that provides a subset of the full input example:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  }
]
----
.. From the Configuration tab in the Write operation, click Map and connect the Input fields to the Output fields.
+
Ignore all Input fields that do not have corresponding Output fields.
+
[cols="1,10"]
|===
| image:icon_custom_data_type.png[Customize Data Type button]
| Customize Data Type button - If the Output column lacks your custom data type, you can load it through this button (located at lower-left corner of the Output column).
|===
+
The mapping will look like this when you are done:
+
image:ftp_read_map.png[FTP Read Operation Mapping]
.. From the Source tab at the bottom of the Content window, make sure your source looks like this:
+
----
%dw 2.0

%output application/json
---
(payload map (value0) -> {
    "id": value0.id,
    "name": value0.name,
    "username": value0.username,
    "email": value0.email,
    "website": value0.website
  })
----
+
If you see `(value0, index0)`, you can change it to `(value0)` because `index0` key is not used by the transformation. Note that you might need to remove a leading `(payload ++` and trailing `)` so that the output only includes the mapped payload and is not preceded by a copy of the unmapped payload.
.. Close the Content window.
+
In the Write operation, the Content should match the content in the Source tab.
+
. Add a Logger to the end of your flow.
+
Message setting: `payload`
+
. Sync your application.
. [Optional] Use a locally hosted FTP client, such a FileZilla, to see the new JSON file (here, `partial_record.json`) on your FTP server.
+
It should look something like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "website": "anastasia.net"
  }
]
----

[[see_also]]
== See Also

include::include_link_list.adoc[tags=ftp-set-up]

include::include_link_list.adoc[tags=sftp-set-up]

include::include_link_list.adoc[tags=perform-basic-operations]

include::include_link_list.adoc[tags=ftp-connector]

include::include_link_list.adoc[tags=tech-ref-ftp]
