= To List Files with a Connector
:keywords: file, ftp, connector, operation
:toc:
:toc-title:

toc::[]

For Anypoint Studio, Design Center: FTP connector

Uses the connector's *List* operation to list all files in a directory that match file properties. The operation can recurse through subdirectories.

////
_TODO: FOR CONCEPT?_
The output of this message will be a List<Message>. Each of the messages in the list corresponds to a file found in that directory. The message payload will be an InputStream with the file’s content and the attributes will be the corresponding FileAttributes object. If a sub-directory was found, then the payload will be null.

NOTE: Notice that there’s no autoDelete, copyTo, moveTo or any attribute of the sort. If you need that kind of logic, you’ll have to do it yourself

NOTE 2: All of these attributes accepts expressions
////

. After adding the connector to your flow, select the *List* operation. For example, you might place it inside a *Poll* or *File Listener* element.
. Set up or select a *Configuration* for the connector.
. Provide a *Directory Path* to the files that you want to list.
. Check *Recursive* if you want to include the contents of subdirectories.
. For other settings, go to link:#see_also[See also].

[[see_also]]
== See Also

include::include_link_list.adoc[tags=ftp-set-up]

include::include_link_list.adoc[tags=match-file-props]

include::include_link_list.adoc[tags=set-data-types]

include::include_link_list.adoc[tags=ftp-connector]

include::include_link_list.adoc[tags=tech-ref-ftp]

////
//List files on demand. In combination with the file matcher, this capability makes it possible to use this connector in tandem with other Mule elements such as `<poll>` or `<watermark>`. The `list` operation returns a `TreeNode`.

Navigation example

<flow name="list">
    <file:list directoryPath="~/dropFolder">
<file:match-with>
<file:matcher filename-pattern="*.csv" />
</file:match-with>
    </file:list>
    <foreach>
        <choice>
            <when expression="message.attributes.isDirectory()">
                <flow-ref name="processDirectory" />
            </when>
            <otherwise>
                <logger message="Found file #[message.attributes.path] which content is #[payload]" />
            </otherwise>
        </choice>
    </foreach>
</flow>

GOTCHA: Notice the payload expression. Even though List returns a list of messages, the payload is actually mapped to the actual payload of the current message. The second .payload is to access the actual InputStream that the message holds.

NOTE: This approach is useful in many scenarios such as file synchronization and makes it easy to run transformations which can consider the whole tree. However, for uses cases in which you want to recursively walk a file tree this is kind of cumbersome, mainly because Mule is no friend of recursive flows and we don’t want to generate usability which requires our users to handle recursive algorithms. For such cases, look at the walk operation
Using it with watermark

<flow name="syncWithWatermark" processingStrategy="synchronous">
    <poll>
        <fixed-frequency-scheduler frequency="1" timeUnit="HOURS" />
        <watermark variable="timestamp" default-expression="#[server.dateTime]"
 selector="MAX" selector-expression="#[payload.metadata.lastModifiedTime]" />


        <file:list basePath="~/dropfolder">
            <file:match-with>
<file:matcher updatedSince="#[flowVars['timestamp']]" />
</file:match-with>
</file:list>
    </poll>


    <flow-ref name="doYourSyncMagic" />
</flow>

<file:list directoryPath="~/dropfolder"
	recursive="true|false"
	matchWith="">
		<file:match-with>
	<file:matcher directory="true" />
	</file:match-with>
</file:list>
////
