= AS2 and EDI X12 Purchase Order WalkThrough
:keywords: b2b, as2, edi, x12, dataweave



This page shows how to use Anypoint Partner Manager (APM) to manage and track B2B processes. The goal is to  develop a Mule application, representing a customer, that transforms an XML purchase order read from the filesystem to an X12 850 and sends it to a supplier over AS2.
The supplier returns an X12 997 to an AS2 endpoint on which the application is listening in order to inform the customer that the 850 was either accepted or rejected.
APM manages and records all B2B exchanges while the actual files exchanged are stored on an Amazon S3 bucket.

image:B2B_AS2EDI_01.png[B2B_AS2EDI_01]

=== Audience

This document is intended for a technical audience with basic knowledge of link:getting-started[Anypoint Platform], including:

* link:/mule-user-guide/v/3.8/dataweave[DataWeave]
* link:http://modusintegration.github.io/mule-connector-as2/[AS2 Connector]
* link:/anypoint-b2b/x12-module[X12 Module]

=== Prerequisites

* Anypoint Studio with Mule Server 3.7.x EE runtime
* link:/anypoint-b2b/as2-connector[AS2 Connector 2.x]
* link:/anypoint-b2b/partner-manager-connector[Partner Manager Connector 2.x]
* link:/anypoint-b2b/x12-module[X12 Module]
* https://developer.mulesoft.com/[Anypoint Platform account]
* link:/anypoint-b2b/concepts#tracking-data-storage[Amazon S3 bucket for AS2 and EDI file storage] (optional)

////
== Walkthrough Resources

You will used these resources after you

* link:_attachments/as2-x12-walkthrough.zip[as2-x12-walkthrough.zip]
* link:_attachments/as2-x12-po.xml[as2-x12-po.xml]
* link:_attachments/as2-x12-po.xsd[as2-x12-po.xsd]

////

== Partnership Set Up

The first step in building the solution is to create a partnership in Anypoint Partner Manager between your organization and a supplier.

NOTE: In this walkthrough, we show an example in which you initiate an order from a supplier, but APM works equally well when a customer is ordering from you.

A partnership:

* Identifies your company
* Identifies your partner
* Establishes the parameters by which B2B data is exchanged between you and your partner
* Allows this data to be tracked and viewed from Anypoint Partner Manager

=== Set Up Home Organization Identifiers

. Login into Anypoint Partner Manager.
. On the left menu, click *Trading Partners*.
. Click on the top partner in the list, "Your company".
. On the left menu, click *Identifiers*.
. Enter _MOUNTAINOUT_ as *AS2 Identity* and press *Save*.
. On the left menu, click *X12* under *FORMAT DEFAULTS*.
. Enter _MOUNTAINOUT_ as *Interchange ID (ISA)*, Select *ZZ (Mutually Defined)* from the *Interchange ID qualifier (ISA)* and click *Save*.

== Create Partner

. On the left menu, click *Trading Partners*.
. In the upper right corner, click *New Partner* .
. Enter _My Supplier_ as *Company Name* and click *Save*.

=== Set Partner Identities and Endpoints

In this section, you will:

* Configure the partner's AS2 and X12 identities
* Set the runtime parameters with which the AS2 Connector and X12 Module operate when sending to the supplier or receiving from that supplier

==== Create AS2 Identity
. On the left menu, click *Identifiers*.
. Enter _My Supplier_ as *AS2 Identity* and click *Save*.

==== Configure AS2 Endpoint

. On the left menu, click *Endpoints* under *CONFIGURATION*.
. In the top right, Click New.
. In the *Endpoint* section, fill in the fields as shown in the table below:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|Name |AS2 Send
|Protocol |AS2
|Type |Send
|Default |TRUE
|===
+
. Make sure *Default for My Supplier* is checked.
. In the *Settings* section, fill in the fields as shown in the table below:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|URL |http://localhost:8082
|MDN Required |TRUE
|===
+
. Press *Save*.
. In the top right, Click New.
. In the *Endpoint* section, fill in the fields as shown in the table below:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|Name |AS2 Receive
|Protocol |AS2
|Type |Receive
|Default |TRUE
|===
+
. Verify that *Default for My Supplier* is selected.
. In the *Settings* section, fill in the fields as shown in the table below:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|URL |http://localhost:8081
|Default |TRUE
|===
+
. Click *Save*, then click *Endpoints* with the back arrow on the left menu.

==== Configure X12 Endpoint

. On the left menu, click *X12* under *FORMAT DEFAULTS*.
. Enter _My Supplier_ as *Interchange ID (ISA)*, Select *ZZ (Mutually Defined)* from the *Interchange ID qualifier (ISA)*.
. In the *Inbound* section, fill in the fields as shown in the table below: 
+
[%autowidth.spread]
|===
|*Field* |*Value*
|Interchange sender ID qualifier  (ISA 05) |ZZ
|Interchange sender ID (ISA 06) |MY-SUPPLIER
|Require unique GS control numbers (GS 06) |FALSE
|===
+
. In the *Outbound* section, fill in the fields as shown in the table below:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|Interchange receiver ID qualifier (ISA 07) |ZZ
|Interchange receiver ID (ISA 08) |MY-SUPPLIER
|Repetition separator character (ISA 11) |U
|Default Interchange usage indicator (ISA 15) |Test
|Component element separator character (ISA 16) |>
|Segment terminator character |~
|Data Element Delimiter |*
|Character set |Extended
|Character encoding |ASCII
|Line ending between segments |LFCR
|Require unique GS control numbers (GS 06) |TRUE
|===

. Press *Save*.

== Identify or Create an API Key

In order to create a Mule project, you must enter an link:/anyypoint-b2b/glossary#secta[API Key] and an link:/anypoint-b2b/glossary#secte[Environment ID].

If you have an existing API Key, use it. If you do not know it, consult your organization's MuleSoft representative.

If your organization has not created an API Key, you can create one.

WARNING: The API Key is used by any Mule application across your entire Master link:/access-management/organization[Organization] that communicates with Anypoint Partner Manager. Therefore, before you create a new API Key, coordinate with your organization's MuleSoft administrator to ensure that none of your organization's processes are using an existing API Key because, if they are, creating a new API Key will cause them to cease functioning. In that case, instead of creating a new API Key, use the existing API Key.

To obtain a key, see link:/anypoint-b2b/administration#create-a-new-api-key[Create a New API Key].


You can determine your environment ID on the same page that you create a new API key.

== Setup the Mule project

. Download the link:_attachments/as2-x12-walkthrough.zip[as2-x12-walkthrough.zip application], and unzip.
. Import the application in Anypoint Studio: click *File* > *Import* > *Anypoint Studio Project from External Location*. Click *Next*, select the downloaded application, and click *Finish*.
. Click the file _customer.xml_ in the app directory, and select the Global view tab. Double-click the B2B global element configuration and insert the API key you created from Anypoint Partner Manager.

== Run the Project

. Right-click on the imported project directory _as2-x12-walkthrough_. Select *Run As* and click *Mule Application*.
. Inside the project is a file in _src/test/resources_ called link:_attachments/as2-x12-po.xml[po.xml]. Create a copy and place it in the _outbox_ directory.
. The file should disappear from the directory since the File message source deletes the file once it reads it.
. Access the B2B Transmissions view in Anypoint Partner Manager to confirm that the AS2 and X12 transmissions have taken place.


////
== Run Application

. Run the application as a *Mule Application*. On startup, the application creates the _outbox_ directory in the project’s root directory. If the _outbox_ directory isn’t visible, try refreshing the project in the *Package Explorer* view.

. Drop the purchase order file _po.xml_, included with this document, in the _outbox_ directory. The file should disappear from the directory since the *File* inbound endpoint deletes the file after it reads it.
. Access the B2B Transmissions page in Anypoint Partner Manager to confirm that the AS2 and X12 transmissions have taken place.
+
////

image:B2B_AS2EDI_22.png[B2B_AS2EDI_22]
